{
  "version": 3,
  "sources": ["../index.js"],
  "sourceRoot": "./dist",
  "sourcesContent": ["export default {\r\n  async fetch(request, env, ctx) {\r\n    // Handle CORS preflight\r\n    if (request.method === \"OPTIONS\") {\r\n      return new Response(null, {\r\n        headers: {\r\n          \"Access-Control-Allow-Origin\": \"*\",\r\n          \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\r\n          \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n        },\r\n      });\r\n    }\r\n\r\n    if (request.method !== \"POST\") {\r\n      return new Response(\"SignSense API: Send POST with landmarks\", {\r\n        status: 200,\r\n      });\r\n    }\r\n\r\n    try {\r\n      const data = await request.json();\r\n      const landmarks = data.landmarks;\r\n\r\n      if (!Array.isArray(landmarks) || landmarks.length < 21) {\r\n        return new Response(\r\n          JSON.stringify({ success: false, error: \"NO_LANDMARKS\" }),\r\n          {\r\n            status: 200,\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              \"Access-Control-Allow-Origin\": \"*\",\r\n            },\r\n          },\r\n        );\r\n      }\r\n\r\n      const { sign, confidence, debug } = classifySign(landmarks);\r\n\r\n      return new Response(\r\n        JSON.stringify({ success: true, sign, confidence, debug }),\r\n        {\r\n          status: 200,\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n          },\r\n        },\r\n      );\r\n    } catch (e) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          error: \"SERVER_ERROR\",\r\n          message: e.message,\r\n        }),\r\n        {\r\n          status: 500,\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n          },\r\n        },\r\n      );\r\n    }\r\n  },\r\n};\r\n\r\n// --- Classification Logic ---\r\n\r\nfunction dist(a, b) {\r\n  if (!a || !b) return 0.0;\r\n  return Math.hypot((a.x || 0) - (b.x || 0), (a.y || 0) - (b.y || 0));\r\n}\r\n\r\nfunction classifySign(landmarks) {\r\n  const byName = {};\r\n  landmarks.forEach((lm) => {\r\n    if (lm.name) byName[lm.name] = lm;\r\n  });\r\n\r\n  const g = (name, idx) => byName[name] || landmarks[idx] || null;\r\n\r\n  const wrist = g(\"wrist\", 0);\r\n  const thumbTip = g(\"thumb_tip\", 4);\r\n  const thumbIp = g(\"thumb_ip\", 3);\r\n  const indexTip = g(\"index_finger_tip\", 8);\r\n  const indexPip = g(\"index_finger_pip\", 6);\r\n  const middleTip = g(\"middle_finger_tip\", 12);\r\n  const middlePip = g(\"middle_finger_pip\", 10);\r\n  const ringTip = g(\"ring_finger_tip\", 16);\r\n  const ringPip = g(\"ring_finger_pip\", 14);\r\n  const pinkyTip = g(\"pinky_finger_tip\", 20);\r\n  const pinkyPip = g(\"pinky_finger_ip\", 18);\r\n\r\n  if (!wrist)\r\n    return { sign: \"Unknown\", confidence: 0.1, debug: { error: \"NO_WRIST\" } };\r\n\r\n  const isExtended = (tip, pip) => {\r\n    if (!tip || !pip) return false;\r\n    return dist(tip, wrist) > dist(pip, wrist) + 0.04;\r\n  };\r\n\r\n  const fingers = {\r\n    thumb: isExtended(thumbTip, thumbIp),\r\n    index: isExtended(indexTip, indexPip),\r\n    middle: isExtended(middleTip, middlePip),\r\n    ring: isExtended(ringTip, ringPip),\r\n    pinky: isExtended(pinkyTip, pinkyPip),\r\n  };\r\n\r\n  const count = Object.values(fingers).filter(Boolean).length;\r\n  const pinchD = dist(thumbTip, indexTip);\r\n\r\n  // --- Rules ---\r\n  if (\r\n    fingers.pinky &&\r\n    !fingers.thumb &&\r\n    !fingers.index &&\r\n    !fingers.middle &&\r\n    !fingers.ring\r\n  ) {\r\n    return {\r\n      sign: \"Pinky\",\r\n      confidence: 0.88,\r\n      debug: { ...fingers, reason: \"TOILET\" },\r\n    };\r\n  }\r\n  if (\r\n    fingers.middle &&\r\n    !fingers.thumb &&\r\n    !fingers.index &&\r\n    !fingers.ring &&\r\n    !fingers.pinky\r\n  ) {\r\n    return {\r\n      sign: \"Middle\",\r\n      confidence: 0.88,\r\n      debug: { ...fingers, reason: \"ANGRY\" },\r\n    };\r\n  }\r\n  if (\r\n    fingers.ring &&\r\n    fingers.middle &&\r\n    fingers.pinky &&\r\n    !fingers.thumb &&\r\n    !fingers.index\r\n  ) {\r\n    return {\r\n      sign: \"Ring Pinky Middle\",\r\n      confidence: 0.9,\r\n      debug: { ...fingers, reason: \"AWESOME\" },\r\n    };\r\n  }\r\n  if (thumbTip && indexTip && pinchD < 0.06) {\r\n    return {\r\n      sign: \"Pinch\",\r\n      confidence: 0.86,\r\n      debug: { ...fingers, pinch_distance: pinchD },\r\n    };\r\n  }\r\n  if (fingers.index && !fingers.middle && !fingers.ring && !fingers.pinky) {\r\n    return {\r\n      sign: \"Point\",\r\n      confidence: 0.87,\r\n      debug: { ...fingers, reason: \"POINT\" },\r\n    };\r\n  }\r\n  if (fingers.index && fingers.middle && !fingers.ring && !fingers.pinky) {\r\n    return {\r\n      sign: \"Peace\",\r\n      confidence: 0.88,\r\n      debug: { ...fingers, reason: \"PEACE\" },\r\n    };\r\n  }\r\n  if (fingers.index && fingers.pinky && !fingers.middle && !fingers.ring) {\r\n    return {\r\n      sign: \"Rock\",\r\n      confidence: 0.88,\r\n      debug: { ...fingers, reason: \"ROCK\" },\r\n    };\r\n  }\r\n  if (fingers.thumb && count === 1) {\r\n    return {\r\n      sign: \"Thumbs Up\",\r\n      confidence: 0.9,\r\n      debug: { ...fingers, reason: \"THUMBS_UP\" },\r\n    };\r\n  }\r\n  if (count === 0) {\r\n    return {\r\n      sign: \"Fist\",\r\n      confidence: 0.85,\r\n      debug: { ...fingers, reason: \"FIST\" },\r\n    };\r\n  }\r\n  if (count === 5) {\r\n    return {\r\n      sign: \"Open Hand\",\r\n      confidence: 0.92,\r\n      debug: { ...fingers, reason: \"OPEN_HAND\" },\r\n    };\r\n  }\r\n  if (count === 4)\r\n    return { sign: \"Four Fingers\", confidence: 0.82, debug: { ...fingers } };\r\n  if (count === 3)\r\n    return { sign: \"Three Fingers\", confidence: 0.8, debug: { ...fingers } };\r\n\r\n  return { sign: \"Unknown\", confidence: 0.3, debug: { ...fingers } };\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
